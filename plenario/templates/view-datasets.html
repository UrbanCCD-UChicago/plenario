{% extends 'base.html' %}
{% block title %}View datasets - Plenar.io{% endblock %}
{% block extra_styles %}
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.2/css/jquery.dataTables.css">
{% endblock %}
{% block content %}
    {% if errors %}
        <h4>There were some problems with your submission: </h4>
        {% for error in errors %}
            <p>{{error}}</p>
        {% endfor %}
    {% endif %}
    <h2>
        {{ datasets|length }} datasets
        <small><a href='/add-dataset'>Add dataset &raquo;</a></small>
    </h2>
    <div id="errors"></div>
    <table id='datasets-table' class="table table-condensed">
        <thead>
            <th>Name</th>
            <th>Time span available</th>
            <th>Update frequency</th>
            <th>Last updated</th>
            <th></th>
            <th></th>
        </thead>
        <tbody>
            {% for dataset in datasets %}
                <tr>
                    <td>{{ dataset.human_name }}</td>
                    <td>
                        {% if dataset.obs_from and dataset.obs_to %}
                            {{ dataset.obs_from }} â€” {{dataset.obs_to}}
                        {% endif %}
                    </td>
                    <td>{{ dataset.update_freq }}</td>
                    <td>{{ dataset.last_update }}</td>
                    <td><button class="btn btn-default btn-sm update-dataset" data-dataset="{{dataset.four_by_four}}"><i class='fa fa-refresh'></i> Update now</button></td>
                    <td>
                        <a href="{{ url_for('views.edit_dataset', four_by_four=dataset.four_by_four) }}"
                            class="btn btn-info btn-sm">
                            <i class='fa fa-edit'></i> Edit
                        </a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock content %}
{% block extra_javascript %}
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.2/js/jquery.dataTables.js"></script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('.update-dataset').on('click', function(e){
                e.preventDefault()
                var dataset_id = $(this).data('dataset')
                $.getJSON('/update-dataset/' + dataset_id, function(resp){
                    console.log(resp);
                    window.location.reload();
                })
            })
            $('#datasets-table').DataTable( {
                "aaSorting": [ [0,'asc'] ],
                "aoColumns": [
                    null,
                    null,
                    null,
                    null,
                    { "bSortable": false },
                    { "bSortable": false }
                ],
                "paging": false,
                "searching": false,
                "info": false
            } );
        })
    </script>
{% endblock %}
